"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1403],{385:(y,E,r)=>{r.d(E,{l:()=>t});var d=r(4438),u=r(7863);let t=(()=>{var h;class a{constructor(){this.titulo=""}Salir(){}}return(h=a).\u0275fac=function(_){return new(_||h)},h.\u0275cmp=d.VBU({type:h,selectors:[["app-header"]],inputs:{titulo:"titulo"},decls:5,vars:2,consts:[[3,"translucent"],["color","primary"],["slot","end"]],template:function(_,e){1&_&&(d.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title",1),d.EFF(3),d.k0s(),d.nrm(4,"ion-buttons",2),d.k0s()()),2&_&&(d.Y8G("translucent",!0),d.R7$(3),d.JRh(e.titulo))},dependencies:[u.QW,u.eU,u.BC,u.ai]}),a})()},1977:(y,E,r)=>{r.d(E,{C:()=>e});var d=r(467),u=r(5312),t=r(4438),h=r(431),a=r(7863),T=r(8856),_=r(4341);let e=(()=>{var s;class i{constructor(o,c,f,m){this.stellar=o,this.modalCtrl=c,this.oCom=f,this.loadingCtrl=m,this.tienda={},this.cantidad=0,this.mensaje="",this.laTienda={id:"",nombre:"",hash:"",logo:"",public:"",info:"",cuenta:"",CIF:"",contacto:"",direccion:"",movil:"",correo:"",coordenadas:""}}ngOnInit(){var o=this;return(0,d.A)(function*(){o.token=yield o.oCom.getTokenPromise(u.c.login,u.c.password),""!=o.token&&(yield o.oCom.getUnComercio(o.token,o.tienda.id).then(c=>{console.log("A ver ese comercio",c),o.tienda.logo=c.logo})),(null==o.tienda.logo||""==o.tienda.logo)&&(o.tienda.logo=u.c.logo_vacio)})()}showLoading(){var o=this;return(0,d.A)(function*(){(yield o.loadingCtrl.create({showBackdrop:!0,backdropDismiss:!1,translucent:!0,duration:0,mode:"ios"})).present()})()}pagar(){var o=this;return(0,d.A)(function*(){o.mensaje="",o.showLoading();try{o.oCom.getEstadoCuenta(u.c.publicUsuario,o.token).then(c=>{o.stellar.TransferirCripto(o.tienda.clave,u.c.secretUsuario,c.emisora,o.cantidad),setTimeout(()=>{o.loadingCtrl.dismiss(),o.salirSin()},1e4)})}catch(c){console.log("ha petao",c),o.mensaje="Error realizando pago",setTimeout(()=>{o.loadingCtrl.dismiss()},3e3)}})()}salirSin(){this.modalCtrl.dismiss(!1)}salirCon(){this.modalCtrl.dismiss(!0)}}return(s=i).\u0275fac=function(o){return new(o||s)(t.rXU(h.x),t.rXU(a.W3),t.rXU(T.M),t.rXU(a.Xi))},s.\u0275cmp=t.VBU({type:s,selectors:[["app-pagos"]],inputs:{tienda:"tienda"},decls:19,vars:5,consts:[[1,"ion-padding",3,"fullscreen"],[3,"src"],[1,"input-item"],["type","text","placeholder","Cantidad","name","txtCantidad",3,"ngModelChange","ngModel"],["expand","block",1,"login-button",3,"click"],["expand","block","expand","block","color","light",1,"google-button",3,"click"],["color","white"],[1,"copyright"]],template:function(o,c){1&o&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s()()(),t.j41(4,"ion-content",0),t.nrm(5,"ion-img",1),t.j41(6,"ion-item")(7,"fieldset",2)(8,"legend"),t.EFF(9,"Cantidad ILLAs"),t.k0s(),t.j41(10,"ion-input",3),t.mxI("ngModelChange",function(m){return t.DH7(c.cantidad,m)||(c.cantidad=m),m}),t.k0s()()(),t.j41(11,"ion-button",4),t.bIt("click",function(){return c.pagar()}),t.EFF(12," Pagar "),t.k0s(),t.j41(13,"ion-button",5),t.bIt("click",function(){return c.salirSin()}),t.EFF(14," Volver "),t.k0s()(),t.j41(15,"ion-footer",6)(16,"ion-toolbar")(17,"p",7),t.EFF(18),t.k0s()()()),2&o&&(t.R7$(3),t.JRh(c.tienda.nombre),t.R7$(),t.Y8G("fullscreen",!0),t.R7$(),t.FS9("src",c.tienda.logo),t.R7$(5),t.R50("ngModel",c.cantidad),t.R7$(8),t.JRh(c.mensaje))},dependencies:[_.BC,_.vS,a.Jm,a.W9,a.M0,a.eU,a.KW,a.$w,a.uz,a.BC,a.ai,a.Gw]}),i})()},1403:(y,E,r)=>{r.r(E),r.d(E,{TiendasPageModule:()=>R});var d=r(177),u=r(4341),t=r(7863),h=r(8986),a=r(467),T=r(1977),_=r(5312),e=r(4438),s=r(1626);let i=(()=>{var l;class v{constructor(n){this.http=n}getTiendas(){return this.http.get("https://jsonplaceholder.typicode.com/users")}}return(l=v).\u0275fac=function(n){return new(n||l)(e.KVO(s.Qq))},l.\u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"}),v})();var g=r(7291),o=r(8856),c=r(385);function f(l,v){if(1&l){const C=e.RV6();e.j41(0,"ion-item-sliding")(1,"ion-item")(2,"ion-label")(3,"h3"),e.EFF(4),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s()(),e.j41(7,"ion-button",3),e.bIt("click",function(){const p=e.eBV(C).$implicit,P=e.XpG();return e.Njj(P.comprar(p))}),e.EFF(8," Comprar "),e.k0s()()()}if(2&l){const C=v.$implicit;e.R7$(4),e.JRh(C.nombre),e.R7$(2),e.JRh(C.id)}}const M=[{path:"",component:(()=>{var l;class v{constructor(n,p,P,D,U){this.dataService=n,this.disco=p,this.modalCtrl=P,this.oCom=D,this.loadingCtrl=U,this.nombre="",this.logo_vacio=_.c.logo_vacio,this.tiendas=[],this.unaTienda={id:"",nombre:"",hash:"",public:""}}ngOnInit(){var n=this;return(0,a.A)(function*(){n.tiendas=yield n.disco.cargarTiendas(),n.tiendas=n.tiendas||[],console.log("tiendas",n.tiendas),0==n.tiendas.length&&(yield n.cargarTiendas().then(()=>n.loadingCtrl.dismiss()))})()}showLoading(){var n=this;return(0,a.A)(function*(){(yield n.loadingCtrl.create({showBackdrop:!0,backdropDismiss:!1,translucent:!0,duration:0,mode:"ios"})).present()})()}cargarTiendas(){var n=this;return(0,a.A)(function*(){try{n.showLoading(),yield n.disco.borrarTiendas();let p=yield n.oCom.getTokenPromise(_.c.login,_.c.password);""!=p?n.oCom.getComercios(p).subscribe({next:P=>{console.log("Dentro de inicio comercios",P),n.tiendas=P.listado?P.listado:[];try{n.disco.guardarTiendas(n.tiendas)}catch(D){console.log("Error guardando en disco",D)}},error:P=>{console.log("Error recuperando comercios",P)}}):(console.log("error recuperando token"),n.loadingCtrl.dismiss())}catch(p){console.log("Error borrando tiendas",p),n.loadingCtrl.dismiss()}})()}seleccionar(n){console.log(n),this.unaTienda=n}comprar(n){this.unaTienda=n,this.realizarPago(n)}realizarPago(n){var p=this;return(0,a.A)(function*(){const P=yield p.modalCtrl.create({component:T.C,componentProps:{tienda:n}});yield P.present(),yield P.onDidDismiss()})()}}return(l=v).\u0275fac=function(n){return new(n||l)(e.rXU(i),e.rXU(g.n),e.rXU(t.W3),e.rXU(o.M),e.rXU(t.Xi))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-tiendas"]],inputs:{nombre:"nombre"},decls:4,vars:3,consts:[[3,"titulo"],[3,"fullscreen"],[4,"ngFor","ngForOf"],["expand","block","fill","clear","shape","round",3,"click"]],template:function(n,p){1&n&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content",1)(2,"ion-list"),e.DNE(3,f,9,2,"ion-item-sliding",2),e.k0s()()),2&n&&(e.Y8G("titulo",p.nombre||"Comercios"),e.R7$(),e.Y8G("fullscreen",!0),e.R7$(2),e.Y8G("ngForOf",p.tiendas))},dependencies:[d.Sq,t.Jm,t.W9,t.uz,t.A7,t.he,t.nf,c.l],styles:[".odd[_ngcontent-%COMP%]{background:#defafb}.even[_ngcontent-%COMP%]{background:#b7f5b7}"]}),v})()}];let A=(()=>{var l;class v{}return(l=v).\u0275fac=function(n){return new(n||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[h.iI.forChild(M),h.iI]}),v})();var O=r(5553);let R=(()=>{var l;class v{}return(l=v).\u0275fac=function(n){return new(n||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[d.MD,u.YN,t.bv,A,O.h]}),v})()},8856:(y,E,r)=>{r.d(E,{M:()=>T});var d=r(467),u=r(1626),t=r(5312),h=r(4438);const a=t.c.servidorVst;let T=(()=>{var _;class e{constructor(i){this.http=i}getToken(i="",g=""){let o=new u.Lr;const c=(new u.Nl).set("username",i).set("password",g).set("grant_type","password");return o.append("Content-Type","application/x-www-form-urlencoded"),this.http.post(a+"login",c,{headers:o})}getTokenPromise(i="",g=""){var o=this;return(0,d.A)(function*(){return new Promise((c,f)=>{let m=new u.Lr;const M=(new u.Nl).set("username",i).set("password",g).set("grant_type","password");m.append("Content-Type","application/x-www-form-urlencoded"),o.http.post(a+"login",M,{headers:m}).subscribe({next:A=>{c(A.access_token)},error:A=>{f("")}})})})()}getEstadoCuenta(i="",g=""){var o=this;return(0,d.A)(function*(){return new Promise((c,f)=>{const m=(new u.Lr).set("Authorization","Bearer "+g);o.http.get(a+"cuenta/"+i,{headers:m}).subscribe({next:M=>{console.log("valor",M),c(M)},error:M=>{f("")}})})})()}registrarCuenta(i="",g=""){const o=(new u.Lr).set("Authorization","Bearer "+g);return console.log(g),o.set("Accept","*/*"),o.set("Connection","keep-alive"),this.http.post(a+"cuenta/"+i,null,{headers:o})}autorizarCuenta(i="",g=""){const o=(new u.Lr).set("Authorization","Bearer "+g);return console.log(g),o.set("Accept","*/*"),o.set("Connection","keep-alive"),this.http.post(a+"cuenta/"+i+"/autorizacion",null,{headers:o})}getComercios(i=""){let g=(new u.Lr).set("Authorization","Bearer "+i);return g.append("Content-Type","application/json"),this.http.get(a+"comercios",{headers:g})}getUnComercio(i="",g=""){var o=this;return(0,d.A)(function*(){return yield new Promise((c,f)=>{let m=(new u.Lr).set("Authorization","Bearer "+i);m.append("Content-Type","application/json"),o.http.get(a+"comercio/"+g,{headers:m}).subscribe({next:M=>{c(M)},error:M=>{f("")}})})})()}}return(_=e).\u0275fac=function(i){return new(i||_)(h.KVO(u.Qq))},_.\u0275prov=h.jDH({token:_,factory:_.\u0275fac,providedIn:"root"}),e})()},7291:(y,E,r)=>{r.d(E,{n:()=>h});var d=r(467),u=r(4438),t=r(369);let h=(()=>{var a;class T{constructor(e){this.storage=e,this.tiendas=[],this.usuario={},this._storage=null,this.init()}init(){var e=this;return(0,d.A)(function*(){const s=yield e.storage.create();e._storage=s})()}guardarUsuario(e){var s=this;return(0,d.A)(function*(){var i;console.log("storage",e),null===(i=s._storage)||void 0===i||i.set("usuario",e)})()}cargarUsuario(){var e=this;return(0,d.A)(function*(){var s;return e.usuario=yield null===(s=e._storage)||void 0===s?void 0:s.get("usuario"),e.usuario||[]})()}guardarTiendas(e){var s=this;return(0,d.A)(function*(){var i;console.log("storage",e),null===(i=s._storage)||void 0===i||i.set("tiendas",e),console.log("storage2",e)})()}cargarTiendas(){var e=this;return(0,d.A)(function*(){var s;const i=yield null===(s=e._storage)||void 0===s?void 0:s.get("tiendas");return e.tiendas=null!=i?i:[],e.tiendas})()}borrarTiendas(){var e=this;return(0,d.A)(function*(){var s;yield null===(s=e._storage)||void 0===s?void 0:s.remove("tiendas")})()}borrarUsuario(){var e=this;return(0,d.A)(function*(){var s;yield null===(s=e._storage)||void 0===s?void 0:s.remove("usuario")})()}}return(a=T).\u0275fac=function(e){return new(e||a)(u.KVO(t.w))},a.\u0275prov=u.jDH({token:a,factory:a.\u0275fac,providedIn:"root"}),T})()}}]);
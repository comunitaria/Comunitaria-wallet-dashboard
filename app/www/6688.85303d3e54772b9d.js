(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6688],{6688:(A,U,l)=>{"use strict";l.r(U),l.d(U,{LoginPageModule:()=>T});var s=l(177),u=l(4341),g=l(7863),y=l(8986),h=l(467),f=l(5312),i=l(4438),n=l(8856),d=l(7291),r=l(431),t=l(3656);l(9812);const a=[{path:"",component:(()=>{var p;class M{constructor(c,v,_,F,P){this.oCom=c,this.disco=v,this.stellar=_,this.loadingCtrl=F,this.navCtrl=P,this.nombre="Login",this.paso="",this.usuario={nombre:"jmdomi",clave:"1",email:""},this.unUsuario={},this.cuenta={clave_publica:"",clave_privada:"",semilla:""},this.tiendas={}}ngOnInit(){}showLoading(){var c=this;return(0,h.A)(function*(){(yield c.loadingCtrl.create({showBackdrop:!0,backdropDismiss:!1,translucent:!0,duration:0,mode:"ios"})).present()})()}inicializarDisco(){this.disco.borrarTiendas(),this.disco.borrarUsuario(),this.paso="Datos eliminados"}onClick(){var c=this;return(0,h.A)(function*(){c.showLoading();var v=!1;c.unUsuario=yield c.disco.cargarUsuario(),console.log(c.unUsuario),null!=c.unUsuario&&c.unUsuario.login==c.usuario.nombre&&c.unUsuario.password==c.usuario.clave&&(v=!0);let _=!1;if(console.log("exite",v),v)setTimeout(()=>{c.loadingCtrl.dismiss(),_||c.navCtrl.navigateForward("/main")},3e3);else try{c.paso="Creando usuario...",yield c.crearUsuario().then(F=>(c.paso=F||"",c.registraCuenta(c.unUsuario.public,c.unUsuario.token))).then(F=>{c.paso=F,c.unUsuario.estado=F,c.disco.guardarUsuario(c.unUsuario).then(function(){console.log("voila")})})}catch{c.paso="Error creando cuenta de usuario",_=!0}finally{setTimeout(()=>{c.loadingCtrl.dismiss(),_||c.navCtrl.navigateForward("/main")},1e4)}f.c.login=c.unUsuario.login||"",f.c.password=c.unUsuario.password||"",f.c.publicUsuario=c.unUsuario.public||"",f.c.secretUsuario=c.unUsuario.secret||"",f.c.clase=c.unUsuario.clase||""})()}onSubmit(){console.log("submit")}crearUsuario(){return new Promise((c,v)=>{console.log("Dentro de crear usuario"),this.oCom.getToken(this.usuario.nombre,this.usuario.clave).subscribe(_=>{console.log("Cojo el token",_),this.cuenta=this.stellar.nuevaCuenta(),this.unUsuario={login:this.usuario.nombre,password:this.usuario.clave,token:_.access_token,clase:_.clase,secret:this.cuenta.clave_privada,public:this.cuenta.clave_publica,estado:"pendiente"},c("pendiente")},_=>{console.log("dentro token",_),v(_),console.log("peta",_.message)})})}autorizaCuenta(c){var v=this;return(0,h.A)(function*(){return new Promise(function(){var _=(0,h.A)(function*(F,P){console.log("Dentro de autorizar cuenta");try{yield v.oCom.autorizarCuenta(v.cuenta.clave_publica,c).subscribe(),console.log("res autorizada"),F("autorizada")}catch(B){console.log("autorizar error",B),P(B)}});return function(F,P){return _.apply(this,arguments)}}())})()}confiaCuenta(c,v,_,F){var P=this;return(0,h.A)(function*(){return new Promise((B,D)=>{try{console.log("Dentro de confiar"),P.stellar.lineaConfianza(c,v,_).then(()=>{P.autorizaCuenta(F).then(L=>{console.log("confiaCuenta",L),B(L)}).catch(L=>{console.log("Confio porque da error",L),B("confiada")})})}catch(L){D(L)}})})()}registraCuenta(c,v){var _=this;return(0,h.A)(function*(){return new Promise((F,P)=>{console.log("Dentro de registrar"),_.oCom.registrarCuenta(c,v).subscribe({next:B=>{_.confiaCuenta(B.emisora,_.unUsuario.secret,B.cripto,v).then(L=>{console.log("registraCuenta",L),F(L)}).catch(L=>{F("registrada")})},error:B=>{P(B)}})})})()}}return(p=M).\u0275fac=function(c){return new(c||p)(i.rXU(n.M),i.rXU(d.n),i.rXU(r.x),i.rXU(g.Xi),i.rXU(t.q9))},p.\u0275cmp=i.VBU({type:p,selectors:[["app-login"]],decls:28,vars:4,consts:[["formulario","ngForm"],[1,"ion-padding",3,"fullscreen"],[1,"container"],[1,"heading"],[1,"para"],[3,"ngSubmit"],[1,"input-item"],["type","text","placeholder","Usuario","name","txtNombre",3,"ngModelChange","ngModel"],["type","password","name","txtClave","required","","placeholder","Clave",3,"ngModelChange","ngModel"],["expand","block",1,"login-button",3,"click"],["expand","block","color","light",1,"google-button",3,"click"],["color","white"],[1,"copyright"]],template:function(c,v){if(1&c){const _=i.RV6();i.j41(0,"ion-content",1)(1,"div",2)(2,"h1",3),i.EFF(3,"\u{1f44b} \xa1Bienvenid@!"),i.nrm(4,"br")(5,"br"),i.k0s(),i.j41(6,"p",4),i.EFF(7,"Introduce tu usuario y clave"),i.k0s(),i.j41(8,"form",5,0),i.bIt("ngSubmit",function(){return i.eBV(_),i.Njj(v.onSubmit())}),i.j41(10,"ion-item")(11,"fieldset",6)(12,"legend"),i.EFF(13,"Usuario"),i.k0s(),i.j41(14,"ion-input",7),i.mxI("ngModelChange",function(P){return i.eBV(_),i.DH7(v.usuario.nombre,P)||(v.usuario.nombre=P),i.Njj(P)}),i.k0s()()(),i.j41(15,"ion-item")(16,"fieldset",6)(17,"legend"),i.EFF(18,"Clave"),i.k0s(),i.j41(19,"ion-input",8),i.mxI("ngModelChange",function(P){return i.eBV(_),i.DH7(v.usuario.clave,P)||(v.usuario.clave=P),i.Njj(P)}),i.k0s()()(),i.j41(20,"ion-button",9),i.bIt("click",function(){return i.eBV(_),i.Njj(v.onClick())}),i.EFF(21,"Entrar"),i.k0s(),i.j41(22,"ion-button",10),i.bIt("click",function(){return i.eBV(_),i.Njj(v.inicializarDisco())}),i.EFF(23," Inicializar datos "),i.k0s()()()(),i.j41(24,"ion-footer",11)(25,"ion-toolbar")(26,"p",12),i.EFF(27),i.k0s()()()}2&c&&(i.Y8G("fullscreen",!0),i.R7$(14),i.R50("ngModel",v.usuario.nombre),i.R7$(5),i.R50("ngModel",v.usuario.clave),i.R7$(8),i.JRh(v.paso))},dependencies:[u.qT,u.BC,u.cb,u.YS,u.vS,u.cV,g.Jm,g.W9,g.M0,g.$w,g.uz,g.ai,g.Gw]}),M})()}];let C=(()=>{var p;class M{}return(p=M).\u0275fac=function(c){return new(c||p)},p.\u0275mod=i.$C({type:p}),p.\u0275inj=i.G2t({imports:[y.iI.forChild(a),y.iI]}),M})();var m=l(5553);let T=(()=>{var p;class M{}return(p=M).\u0275fac=function(c){return new(c||p)},p.\u0275mod=i.$C({type:p}),p.\u0275inj=i.G2t({imports:[s.MD,u.YN,g.bv,C,m.h]}),M})()},8856:(A,U,l)=>{"use strict";l.d(U,{M:()=>f});var s=l(467),u=l(1626),g=l(5312),y=l(4438);const h=g.c.servidorVst;let f=(()=>{var i;class n{constructor(r){this.http=r}getToken(r="",t=""){let o=new u.Lr;const e=(new u.Nl).set("username",r).set("password",t).set("grant_type","password");return o.append("Content-Type","application/x-www-form-urlencoded"),this.http.post(h+"login",e,{headers:o})}getTokenPromise(r="",t=""){var o=this;return(0,s.A)(function*(){return new Promise((e,a)=>{let C=new u.Lr;const m=(new u.Nl).set("username",r).set("password",t).set("grant_type","password");C.append("Content-Type","application/x-www-form-urlencoded"),o.http.post(h+"login",m,{headers:C}).subscribe({next:T=>{e(T.access_token)},error:T=>{a("")}})})})()}getEstadoCuenta(r="",t=""){var o=this;return(0,s.A)(function*(){return new Promise((e,a)=>{const C=(new u.Lr).set("Authorization","Bearer "+t);o.http.get(h+"cuenta/"+r,{headers:C}).subscribe({next:m=>{console.log("valor",m),e(m)},error:m=>{a("")}})})})()}registrarCuenta(r="",t=""){const o=(new u.Lr).set("Authorization","Bearer "+t);return console.log(t),o.set("Accept","*/*"),o.set("Connection","keep-alive"),this.http.post(h+"cuenta/"+r,null,{headers:o})}autorizarCuenta(r="",t=""){const o=(new u.Lr).set("Authorization","Bearer "+t);return console.log(t),o.set("Accept","*/*"),o.set("Connection","keep-alive"),this.http.post(h+"cuenta/"+r+"/autorizacion",null,{headers:o})}getComercios(r=""){let t=(new u.Lr).set("Authorization","Bearer "+r);return t.append("Content-Type","application/json"),this.http.get(h+"comercios",{headers:t})}getUnComercio(r="",t=""){var o=this;return(0,s.A)(function*(){return yield new Promise((e,a)=>{let C=(new u.Lr).set("Authorization","Bearer "+r);C.append("Content-Type","application/json"),o.http.get(h+"comercio/"+t,{headers:C}).subscribe({next:m=>{e(m)},error:m=>{a("")}})})})()}}return(i=n).\u0275fac=function(r){return new(r||i)(y.KVO(u.Qq))},i.\u0275prov=y.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),n})()},7291:(A,U,l)=>{"use strict";l.d(U,{n:()=>y});var s=l(467),u=l(4438),g=l(369);let y=(()=>{var h;class f{constructor(n){this.storage=n,this.tiendas=[],this.usuario={},this._storage=null,this.init()}init(){var n=this;return(0,s.A)(function*(){const d=yield n.storage.create();n._storage=d})()}guardarUsuario(n){var d=this;return(0,s.A)(function*(){var r;console.log("storage",n),null===(r=d._storage)||void 0===r||r.set("usuario",n)})()}cargarUsuario(){var n=this;return(0,s.A)(function*(){var d;return n.usuario=yield null===(d=n._storage)||void 0===d?void 0:d.get("usuario"),n.usuario||[]})()}guardarTiendas(n){var d=this;return(0,s.A)(function*(){var r;console.log("storage",n),null===(r=d._storage)||void 0===r||r.set("tiendas",n),console.log("storage2",n)})()}cargarTiendas(){var n=this;return(0,s.A)(function*(){var d;const r=yield null===(d=n._storage)||void 0===d?void 0:d.get("tiendas");return n.tiendas=null!=r?r:[],n.tiendas})()}borrarTiendas(){var n=this;return(0,s.A)(function*(){var d;yield null===(d=n._storage)||void 0===d?void 0:d.remove("tiendas")})()}borrarUsuario(){var n=this;return(0,s.A)(function*(){var d;yield null===(d=n._storage)||void 0===d?void 0:d.remove("usuario")})()}}return(h=f).\u0275fac=function(n){return new(n||h)(u.KVO(g.w))},h.\u0275prov=u.jDH({token:h,factory:h.\u0275fac,providedIn:"root"}),f})()},7468:A=>{var U={utf8:{stringToBytes:function(l){return U.bin.stringToBytes(unescape(encodeURIComponent(l)))},bytesToString:function(l){return decodeURIComponent(escape(U.bin.bytesToString(l)))}},bin:{stringToBytes:function(l){for(var s=[],u=0;u<l.length;u++)s.push(255&l.charCodeAt(u));return s},bytesToString:function(l){for(var s=[],u=0;u<l.length;u++)s.push(String.fromCharCode(l[u]));return s.join("")}}};A.exports=U},9928:A=>{var U,l;U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",A.exports=l={rotl:function(s,u){return s<<u|s>>>32-u},rotr:function(s,u){return s<<32-u|s>>>u},endian:function(s){if(s.constructor==Number)return 16711935&l.rotl(s,8)|4278255360&l.rotl(s,24);for(var u=0;u<s.length;u++)s[u]=l.endian(s[u]);return s},randomBytes:function(s){for(var u=[];s>0;s--)u.push(Math.floor(256*Math.random()));return u},bytesToWords:function(s){for(var u=[],g=0,y=0;g<s.length;g++,y+=8)u[y>>>5]|=s[g]<<24-y%32;return u},wordsToBytes:function(s){for(var u=[],g=0;g<32*s.length;g+=8)u.push(s[g>>>5]>>>24-g%32&255);return u},bytesToHex:function(s){for(var u=[],g=0;g<s.length;g++)u.push((s[g]>>>4).toString(16)),u.push((15&s[g]).toString(16));return u.join("")},hexToBytes:function(s){for(var u=[],g=0;g<s.length;g+=2)u.push(parseInt(s.substr(g,2),16));return u},bytesToBase64:function(s){for(var u=[],g=0;g<s.length;g+=3)for(var y=s[g]<<16|s[g+1]<<8|s[g+2],h=0;h<4;h++)u.push(8*g+6*h<=8*s.length?U.charAt(y>>>6*(3-h)&63):"=");return u.join("")},base64ToBytes:function(s){s=s.replace(/[^A-Z0-9+\/]/gi,"");for(var u=[],g=0,y=0;g<s.length;y=++g%4)0!=y&&u.push((U.indexOf(s.charAt(g-1))&Math.pow(2,-2*y+8)-1)<<2*y|U.indexOf(s.charAt(g))>>>6-2*y);return u}}},8749:A=>{function U(s){return!!s.constructor&&"function"==typeof s.constructor.isBuffer&&s.constructor.isBuffer(s)}A.exports=function(s){return null!=s&&(U(s)||function l(s){return"function"==typeof s.readFloatLE&&"function"==typeof s.slice&&U(s.slice(0,0))}(s)||!!s._isBuffer)}},9812:(A,U,l)=>{var s,u,g,y,h;s=l(9928),u=l(7468).utf8,g=l(8749),y=l(7468).bin,(h=function(f,i){f.constructor==String?f=i&&"binary"===i.encoding?y.stringToBytes(f):u.stringToBytes(f):g(f)?f=Array.prototype.slice.call(f,0):!Array.isArray(f)&&f.constructor!==Uint8Array&&(f=f.toString());for(var n=s.bytesToWords(f),d=8*f.length,r=1732584193,t=-271733879,o=-1732584194,e=271733878,a=0;a<n.length;a++)n[a]=16711935&(n[a]<<8|n[a]>>>24)|4278255360&(n[a]<<24|n[a]>>>8);n[d>>>5]|=128<<d%32,n[14+(d+64>>>9<<4)]=d;var C=h._ff,m=h._gg,T=h._hh,p=h._ii;for(a=0;a<n.length;a+=16){var M=r,E=t,c=o,v=e;r=C(r,t,o,e,n[a+0],7,-680876936),e=C(e,r,t,o,n[a+1],12,-389564586),o=C(o,e,r,t,n[a+2],17,606105819),t=C(t,o,e,r,n[a+3],22,-1044525330),r=C(r,t,o,e,n[a+4],7,-176418897),e=C(e,r,t,o,n[a+5],12,1200080426),o=C(o,e,r,t,n[a+6],17,-1473231341),t=C(t,o,e,r,n[a+7],22,-45705983),r=C(r,t,o,e,n[a+8],7,1770035416),e=C(e,r,t,o,n[a+9],12,-1958414417),o=C(o,e,r,t,n[a+10],17,-42063),t=C(t,o,e,r,n[a+11],22,-1990404162),r=C(r,t,o,e,n[a+12],7,1804603682),e=C(e,r,t,o,n[a+13],12,-40341101),o=C(o,e,r,t,n[a+14],17,-1502002290),r=m(r,t=C(t,o,e,r,n[a+15],22,1236535329),o,e,n[a+1],5,-165796510),e=m(e,r,t,o,n[a+6],9,-1069501632),o=m(o,e,r,t,n[a+11],14,643717713),t=m(t,o,e,r,n[a+0],20,-373897302),r=m(r,t,o,e,n[a+5],5,-701558691),e=m(e,r,t,o,n[a+10],9,38016083),o=m(o,e,r,t,n[a+15],14,-660478335),t=m(t,o,e,r,n[a+4],20,-405537848),r=m(r,t,o,e,n[a+9],5,568446438),e=m(e,r,t,o,n[a+14],9,-1019803690),o=m(o,e,r,t,n[a+3],14,-187363961),t=m(t,o,e,r,n[a+8],20,1163531501),r=m(r,t,o,e,n[a+13],5,-1444681467),e=m(e,r,t,o,n[a+2],9,-51403784),o=m(o,e,r,t,n[a+7],14,1735328473),r=T(r,t=m(t,o,e,r,n[a+12],20,-1926607734),o,e,n[a+5],4,-378558),e=T(e,r,t,o,n[a+8],11,-2022574463),o=T(o,e,r,t,n[a+11],16,1839030562),t=T(t,o,e,r,n[a+14],23,-35309556),r=T(r,t,o,e,n[a+1],4,-1530992060),e=T(e,r,t,o,n[a+4],11,1272893353),o=T(o,e,r,t,n[a+7],16,-155497632),t=T(t,o,e,r,n[a+10],23,-1094730640),r=T(r,t,o,e,n[a+13],4,681279174),e=T(e,r,t,o,n[a+0],11,-358537222),o=T(o,e,r,t,n[a+3],16,-722521979),t=T(t,o,e,r,n[a+6],23,76029189),r=T(r,t,o,e,n[a+9],4,-640364487),e=T(e,r,t,o,n[a+12],11,-421815835),o=T(o,e,r,t,n[a+15],16,530742520),r=p(r,t=T(t,o,e,r,n[a+2],23,-995338651),o,e,n[a+0],6,-198630844),e=p(e,r,t,o,n[a+7],10,1126891415),o=p(o,e,r,t,n[a+14],15,-1416354905),t=p(t,o,e,r,n[a+5],21,-57434055),r=p(r,t,o,e,n[a+12],6,1700485571),e=p(e,r,t,o,n[a+3],10,-1894986606),o=p(o,e,r,t,n[a+10],15,-1051523),t=p(t,o,e,r,n[a+1],21,-2054922799),r=p(r,t,o,e,n[a+8],6,1873313359),e=p(e,r,t,o,n[a+15],10,-30611744),o=p(o,e,r,t,n[a+6],15,-1560198380),t=p(t,o,e,r,n[a+13],21,1309151649),r=p(r,t,o,e,n[a+4],6,-145523070),e=p(e,r,t,o,n[a+11],10,-1120210379),o=p(o,e,r,t,n[a+2],15,718787259),t=p(t,o,e,r,n[a+9],21,-343485551),r=r+M>>>0,t=t+E>>>0,o=o+c>>>0,e=e+v>>>0}return s.endian([r,t,o,e])})._ff=function(f,i,n,d,r,t,o){var e=f+(i&n|~i&d)+(r>>>0)+o;return(e<<t|e>>>32-t)+i},h._gg=function(f,i,n,d,r,t,o){var e=f+(i&d|n&~d)+(r>>>0)+o;return(e<<t|e>>>32-t)+i},h._hh=function(f,i,n,d,r,t,o){var e=f+(i^n^d)+(r>>>0)+o;return(e<<t|e>>>32-t)+i},h._ii=function(f,i,n,d,r,t,o){var e=f+(n^(i|~d))+(r>>>0)+o;return(e<<t|e>>>32-t)+i},h._blocksize=16,h._digestsize=16,A.exports=function(f,i){if(null==f)throw new Error("Illegal argument "+f);var n=s.wordsToBytes(h(f,i));return i&&i.asBytes?n:i&&i.asString?y.bytesToString(n):s.bytesToHex(n)}}}]);